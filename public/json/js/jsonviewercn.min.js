Ext.override(Ext.tree.TreeNode,{removeAllChildren:function(){while(this.hasChildNodes()){this.removeChild(this.firstChild)}return this},setIcon:function(a){this.getUI().setIcon(a)},setIconCls:function(a){this.getUI().setIconCls(a)}});Ext.override(Ext.tree.TreeNodeUI,{setIconCls:function(a){if(this.iconNode){Ext.fly(this.iconNode).replaceClass(this.node.attributes.iconCls,a)}this.node.attributes.iconCls=a},setIcon:function(a){if(this.iconNode){this.iconNode.src=a||this.emptyIcon;Ext.fly(this.iconNode)[a?"addClass":"removeClass"]("x-tree-node-inline-icon")}this.node.attributes.icon=a}});Ext.override(Ext.Panel,{hideBbar:function(){if(!this.bbar){return}this.bbar.setVisibilityMode(Ext.Element.DISPLAY);this.bbar.hide();this.getBottomToolbar().hide();this.syncSize();if(this.ownerCt){this.ownerCt.doLayout()}},showBbar:function(){if(!this.bbar){return}this.bbar.setVisibilityMode(Ext.Element.DISPLAY);this.bbar.show();this.getBottomToolbar().show();this.syncSize();if(this.ownerCt){this.ownerCt.doLayout()}}});Ext.ux.iconCls=function(){var b="styleSheetIconCls";var a={};Ext.util.CSS.createStyleSheet("/* Ext.ux.iconCls */",b);return{get:function(d){if(!d){return null}if(typeof a[d]==="undefined"){a[d]="icon_"+Ext.id();var c="\n."+a[d]+" { background-image: url("+d+") !important; }";if(Ext.isIE){document.styleSheets[b].cssText+=c}else{Ext.get(b).dom.sheet.insertRule(c,0)}}return a[d]}}}();String.space=function(a){var c=[],b;for(b=0;b<a;b++){c.push(" ")}return c.join("")};function aboutWindow(){var a=[];Ext.getBody().select("div.tab").each(function(c){a.push({title:c.select("h2").first().dom.innerHTML,html:c.select("div").first().dom.innerHTML.replace("{gabor}","如果觉得好用,请按Ctrl+D收藏！谢谢！")})});var b=new Ext.Window({title:document.title,width:640,height:400,modal:true,layout:"fit",items:new Ext.TabPanel({defaults:{autoScroll:true,bodyStyle:"padding: 5px;"},activeTab:0,items:a})});b.show()}Ext.onReady(function(){Ext.BLANK_IMAGE_URL="img/s.gif";Ext.QuickTips.init();var c=new Ext.KeyMap(document,[{key:Ext.EventObject.F,ctrl:true,stopEvent:true,fn:function(){a.ctrlF()}},{key:Ext.EventObject.H,ctrl:true,stopEvent:true,fn:function(){a.hideToolbar()}}]);c.disable();var e={xtype:"propertygrid",id:"grid",region:"east",width:300,split:true,listeners:{beforeedit:function(){return false}},selModel:new Ext.grid.RowSelectionModel(),onRender:Ext.grid.PropertyGrid.superclass.onRender};var b={id:"tree",xtype:"treepanel",region:"center",loader:new Ext.tree.TreeLoader(),lines:true,root:new Ext.tree.TreeNode({text:"JSON"}),autoScroll:true,trackMouseOver:false,listeners:{render:function(i){i.getSelectionModel().on("selectionchange",function(j,k){a.gridbuild(k)})}},bbar:["Search:",new Ext.form.TextField({xtype:"textfield",id:"searchTextField"}),new Ext.Button({text:"GO!",handler:function(){a.searchStart()}}),new Ext.form.Label({id:"searchResultLabel",style:"padding-left:10px;font-weight:bold"}),{iconCls:Ext.ux.iconCls.get("img/arrow_down.png"),text:"Next",handler:function(){a.searchNext()}},{iconCls:Ext.ux.iconCls.get("img/arrow_up.png"),text:"Previous",handler:function(){a.searchPrevious()}}]};var h={id:"edit",xtype:"textarea",style:"font-family:monospace",emptyText:"将JSON数据粘贴到这里!",selectOnFocus:true};var g={id:"viewerPanel",layout:"border",title:"视图",items:[b,e]};var f={id:"textPanel",layout:"fit",title:"JSON数据",tbar:[{text:"获取网络json",handler:function(){a.getJsonByUrl()}},"-",{text:"粘贴",handler:function(){a.pasteText()}},{text:"复制",handler:function(){a.copyText()}},"-",{text:"格式化",handler:function(){a.format()}},"-",{text:"删除空格",handler:function(){a.removeWhiteSpace()}},"-",{text:"删除空格并转义",handler:function(){a.removeWhiteSpace2()}},"->",{text:"回到首页",handler:function(){window.location.href="http://www.cjblog.org/"}},{text:"关于",handler:aboutWindow}],items:h};var d=new Ext.Viewport({layout:"fit",items:{xtype:"tabpanel",items:[g,f],activeTab:"textPanel",listeners:{beforetabchange:function(i,j){if(j.id==="viewerPanel"){return a.check()}},tabchange:function(i,j){if(j.id==="viewerPanel"){c.enable()}else{c.disable()}}}}});var a=function(){var o=Ext.getCmp("edit");var s=Ext.getCmp("tree");var m=s.getRootNode();var i=Ext.getCmp("grid");var r=Ext.getCmp("searchTextField");var p=Ext.getCmp("searchResultLabel");var q={};var l=null;var j=null;var k=null;var n=null;return{check:function(){var u=o.getValue().split("\n").join(" ");try{q=Ext.util.JSON.decode(u)}catch(t){Ext.MessageBox.show({title:"JSON 错误",msg:"JSON 格式错误",icon:Ext.MessageBox.ERROR,buttons:Ext.MessageBox.OK,closable:false});return false}if(l===u){return}l=u;this.treebuild()},treebuild:function(){m.removeAllChildren();m.appendChild(this.json2leaf(q));m.setIcon(Ext.isArray(q)?"img/array.gif":"img/object.gif");this.gridbuild(m)},gridbuild:function(w){if(w.isLeaf()){w=w.parentNode}if(!w.childNodes.length){w.expand(false,false);w.collapse(false,false)}var x={};for(var v=0;v<w.childNodes.length;v++){var u=w.childNodes[v].text.split(":");if(u.length>1){x[u[0]]=u[1]}else{x[u[0]]="..."}}i.setSource(x)},json2leaf:function(v){var t=[];for(var u in v){if(v.hasOwnProperty(u)){if(v[u]===null){t.push({text:u+" : null",leaf:true,icon:"img/red.gif"})}else{if(typeof v[u]==="string"){t.push({text:u+' : "'+v[u]+'"',leaf:true,icon:"img/blue.gif"})}else{if(typeof v[u]==="number"){t.push({text:u+" : "+v[u],leaf:true,icon:"img/green.gif"})}else{if(typeof v[u]==="boolean"){t.push({text:u+" : "+(v[u]?"true":"false"),leaf:true,icon:"img/yellow.gif"})}else{if(typeof v[u]==="object"){t.push({text:u,children:this.json2leaf(v[u]),icon:Ext.isArray(v[u])?"img/array.gif":"img/object.gif"})}else{if(typeof v[u]==="function"){t.push({text:u+" : function",leaf:true,icon:"img/red.gif"})}}}}}}}}return t},copyText:function(){if(!o.getValue()){return}Ext.ux.Clipboard.set(o.getValue())},pasteText:function(){o.setValue(Ext.ux.Clipboard.get())},searchStart:function(){if(!j){j=new Ext.util.DelayedTask(this.searchFn,this)}j.delay(150)},searchFn:function(){k=[];if(!r.getValue()){return}this.searchInNode(m,r.getValue());if(k.length){p.setText("");n=0;this.selectNode(k[n]);r.focus()}else{p.setText("Phrase not found!")}},searchInNode:function(u,w){if(u.text.toUpperCase().indexOf(w.toUpperCase())!==-1){k.push(u)}var v=u.isExpanded();u.expand(false,false);for(var t=0;t<u.childNodes.length;t++){if(this.searchInNode(u.childNodes[t],w)){}}if(!v){u.collapse(false,false)}},selectNode:function(t){t.select();s.fireEvent("click",t);while(t!==m){t=t.parentNode;t.expand(false,false)}},searchNext:function(){if(!k||!k.length){return}n=(n+1)%k.length;this.selectNode(k[n])},searchPrevious:function(){if(!k||!k.length){return}n=(n-1+k.length)%k.length;this.selectNode(k[n])},ctrlF:function(){if(!s.getBottomToolbar().isVisible()){s.showBbar()}r.focus(true)},hideToolbar:function(){s.hideBbar()},format:function(){var z=o.getValue().split("\n").join(" ");var w=[];var x=0;var y=false;for(var v=0,u=z.length;v<u;v++){var A=z.charAt(v);if(y&&A===y){if(z.charAt(v-1)!=="\\"){y=false}}else{if(!y&&(A==='"'||A==="'")){y=A}else{if(!y&&(A===" "||A==="\t")){A=""}else{if(!y&&A===":"){A+=" "}else{if(!y&&A===","){A+="\n"+String.space(x*2)}else{if(!y&&(A==="["||A==="{")){x++;A+="\n"+String.space(x*2)}else{if(!y&&(A==="]"||A==="}")){x--;A="\n"+String.space(x*2)+A}}}}}}}w.push(A)}o.setValue(w.join(""))},removeWhiteSpace:function(){o.setValue(a.getRemoveWhiteSpace())},getRemoveWhiteSpace:function(){var y=o.getValue().split("\n").join(" ");var w=[];var x=false;for(var v=0,u=y.length;v<u;v++){var z=y.charAt(v);if(x&&z===x){if(y.charAt(v-1)!=="\\"){x=false}}else{if(!x&&(z==='"'||z==="'")){x=z}else{if(!x&&(z===" "||z==="\t")){z=""}}}w.push(z)}return w.join("")},removeWhiteSpace2:function(){var t=a.getRemoveWhiteSpace().replace(/\"/g,'\\"');o.setValue(t)},getJsonByUrl:function(){Ext.MessageBox.show({title:"获取Json网络数据",msg:'请输入Json网络地址:<br/><span style="color:red;">例如：</span>http://www.cjblog.org/test.json<br/><span style="color:red;">注意：</span>此数据是Google云服务器采集，请不要输入您的本地或者局域网json地址，如果长时间没有动静，请刷新重试<br/><span style="color:red;">申明：</span>本站绝对不保留您的任何json数据，请放心使用',width:450,buttons:Ext.MessageBox.OKCANCEL,multiline:true,fn:function(t,u){if(u){a.ajaxCall(u)}},animateTarget:"mb3"})},ajaxCall:function(t){Ext.MessageBox.show({msg:"正则获取数据，请等待...",progressText:"请等待...",width:300,wait:true,waitConfig:{interval:200},icon:"ext-mb-download",animateTarget:"mb7"});Ext.Ajax.request({url:"/crawl",params:{url:t},success:function(v,u){if(v.responseText){o.setValue(v.responseText);a.format();Ext.MessageBox.hide()}},failure:function(){Ext.Msg.alert("提示","方法调用失败")}})},Obj2str:function(v){if(v==undefined){return"''"}var u=[];if(typeof v=="string"){return'"'+v.replace(/([\"\\])/g,"\\$1").replace(/(\n)/g,"\\n").replace(/(\r)/g,"\\r").replace(/(\t)/g,"\\t")+'"'}if(typeof v=="object"){if(!v.sort){for(var t in v){u.push('"'+t+'":'+a.Obj2str(v[t]))}if(!!document.all&&!/^\n?function\s*toString\(\)\s*\{\n?\s*\[native code\]\n?\s*\}\n?\s*$/.test(v.toString)){u.push("toString:"+v.toString.toString())}u="{"+u.join()+"}"}else{for(var t=0;t<v.length;t++){u.push(a.Obj2str(v[t]))}u="["+u.join()+"]"}return u}return v.toString().replace(/\"\:/g,'":""')}}}()});